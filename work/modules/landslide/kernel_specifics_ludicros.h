/**
 * @file kernel_specifics_ludicros.h
 * @brief #defines for the ludicros guest kernel (automatically generated)
 * @author Ben Blum <bblum@andrew.cmu.edu>
 */

#ifndef __LS_KERNEL_SPECIFICS_LUDICROS_H
#define __LS_KERNEL_SPECIFICS_LUDICROS_H

#include "x86.h"

#define GUEST_ESP0_ADDR (0x00100930 + 4)
#define GUEST_ESP0(cpu) READ_MEMORY(cpu, GUEST_ESP0_ADDR)
#define GUEST_TCB_TID_OFFSET 8
#define TID_FROM_TCB(cpu, tcb) READ_MEMORY(cpu, tcb + GUEST_TCB_TID_OFFSET)
#define STACK_FROM_TCB(tcb) PAGE_ALIGN(tcb)
#define GUEST_STACK_SIZE (PAGE_SIZE-GUEST_TCB_T_SIZE)

#define GUEST_TCB_STATE_FLAG_OFFSET 20

#define GUEST_PCB_PID_OFFSET 24
#define PID_FROM_PCB(cpu, pcb) READ_MEMORY(cpu, pcb + GUEST_PCB_PID_OFFSET)

#define GUEST_TIMER_WRAP_ENTER     0x00101298
#define GUEST_TIMER_WRAP_EXIT      0x101c21
#define GUEST_CONTEXT_SWITCH_ENTER 0x00104907
#define GUEST_CONTEXT_SWITCH_EXIT  0x104994

#define GUEST_FORK_RETURN_SPOT     0x001025f8
#define GUEST_READLINE_WINDOW_ENTER 0x00105010
#define GUEST_READLINE_WINDOW_EXIT 0x1050bb

#define GUEST_MUTEX_LOCK_MUTEX_ARGNUM 1

#define GUEST_LMM_ALLOC_ENTER      0x0010a0a4
#define GUEST_LMM_ALLOC_EXIT       0x10a2d3
#define GUEST_LMM_ALLOC_SIZE_ARGNUM 2
#define GUEST_LMM_ALLOC_GEN_ENTER  0x001069d4
#define GUEST_LMM_ALLOC_GEN_EXIT   0x106d20
#define GUEST_LMM_ALLOC_GEN_SIZE_ARGNUM 2
#define GUEST_LMM_FREE_ENTER       0x00106670
#define GUEST_LMM_FREE_EXIT        0x1068ae
#define GUEST_LMM_FREE_BASE_ARGNUM 2
#define GUEST_LMM_FREE_SIZE_ARGNUM 3
#define GUEST_LMM_REMOVE_FREE_ENTER 0x001068c0
#define GUEST_LMM_REMOVE_FREE_EXIT 0x1069d1

#define GUEST_IMG_END 0x00256a8c
#define GUEST_DATA_START 0x0024e000
#define GUEST_DATA_END 0x00256014
#define GUEST_BSS_START 0x00256014
#define GUEST_BSS_END GUEST_IMG_END
#define GUEST_PANIC 0x001083d8
#define GUEST_KERNEL_MAIN 0x00105620
#define GUEST_OUTB 0x0010868a

#define TELL_LANDSLIDE_SCHED_INIT_DONE 0x00105c38
#define TELL_LANDSLIDE_FORKING 0x00105c3d
#define TELL_LANDSLIDE_VANISHING 0x00105c42
#define TELL_LANDSLIDE_SLEEPING 0x00105c47
#define TELL_LANDSLIDE_THREAD_RUNNABLE 0x00105c4c
#define TELL_LANDSLIDE_THREAD_DESCHEDULING 0x00105c51
#define TELL_LANDSLIDE_MUTEX_LOCKING 0x00105c56
#define TELL_LANDSLIDE_MUTEX_BLOCKING 0x00105c5b
#define TELL_LANDSLIDE_MUTEX_LOCKING_DONE 0x00105c60
#define TELL_LANDSLIDE_MUTEX_UNLOCKING 0x00105c65
#define TELL_LANDSLIDE_MUTEX_UNLOCKING_DONE 0x00105c6a

#define GUEST_SCHEDULER_FUNCTIONS { \
	{ 0x0010439a, 0x1043f4 }, \
	{ 0x00104326, 0x104399 }, \
	{ 0x001042d7, 0x104325 }, \
	{ 0x0010428e, 0x1042d6 }, \
	{ 0x0010484f, 0x1048ca }, \
	{ 0x00104907, 0x104994 }, \
	{ 0x001043f5, 0x10443f }, \
	{ 0x00104a44, 0x104a5c }, \
	{ 0x00104a5d, 0x104a60 }, \
	{ 0x00104721, 0x10484e }, \
	{ 0x00104995, 0x1049f6 }, \
	}
#define GUEST_SCHEDULER_GLOBALS { \
	{ 0x0025604c, 4 }, \
	{ 0x00256948, 4 }, \
	{ 0x0025694c, 4 }, \
	{ 0x00256a74, 8 }, \
	{ 0x00256a84, 8 }, \
	{ 0x00256a6c, 8 }, \
	{ 0x00256a64, 8 }, \
	{ 0x00256a7c, 8 }, \
	{ 0x00256a5c, 8 }, \
	}

#define GUEST_MUTEX_LOCK 0x00102bbb
#define GUEST_VANISH 0x0010260c
#define GUEST_VANISH_END 0x1028ac
#define GUEST_MUTEX_IGNORES { \
	{ 0x00256960, 8 }, \
	{ 0x002569d4, 8 }, \
	{ 0x002569dc, 8 }, \
	{ 0x00256920, 40 }, \
	{ 0x00256480, 40 }, \
	{ 0x002564c0, 40 }, \
	}

#endif
